# AWS SAA 核心考点深度解析：Amazon EBS

本文档针对 Amazon EBS (Elastic Block Store) 的核心架构思想进行深度剖析，重点涵盖 SAA 考试中常见的卷类型选择、高性能配置、数据安全及成本优化策略。

> [!IMPORTANT]
> **SAA 核心解题思路**：
> 1.  **性能需求**：是随机读写（IOPS）还是顺序读写（吞吐量）？
> 2.  **成本敏感**：是否需要高性能？如果不是，是否可以用 gp3 甚至 HDD？
> 3.  **可用性**：EBS 是 AZ 级别的资源。跨 AZ 需要快照。
> 4.  **易变性**：需要持久化存储还是临时缓存？（对比 Instance Store）
> 5.  **安全性**：加密是基于 KMS 的，快照继承加密属性。

---

## 1. EBS 卷类型选型 (Volume Types)

考试中经常需要根据业务场景选择最合理的卷类型。

| 大类 | 卷类型 | 关键特性 | 典型场景 | SAA 考点提示 |
| :--- | :--- | :--- | :--- | :--- |
| **通用 SSD** | **gp3** | **基准 3000 IOPS**，吞吐量和 IOPS 可独立于容量扩展。价格更优。 | 绝大多数生产环境、数据库、虚拟桌面。 | **首选默认项**。如果题目没有特殊极端性能要求，gp3 通常是性价比之选。 |
| | **gp2** | IOPS 与容量挂钩（3 IOPS/GB）。支持突发（Burst）。 | 较旧的通用工作负载、开发测试。 | 现在的考试中，**gp3 优于 gp2**（因为 gp3 不用为了获取 IOPS 而强制扩容）。 |
| **预置 IOPS SSD** | **io1 / io2** | 高达 64,000 IOPS。**io2** 提供 99.999% 的持久性（io1 是 99.8-99.9%）。 | 核心业务数据库（Oracle, SAP HANA, SQL Server），对延迟极其敏感。 | 关键词：**I/O 密集型**、**低延迟**、Mission Critical。如果涉及**多重挂载**（Multi-Attach），必须选 io1/io2。 |
| | **io2 Block Express** | 亚毫秒级延迟，最高 256,000 IOPS。 | 极高性能要求的核心数据库（SAN 替代品）。 | “Block Express” 是当前 EBS 的性能天花板。 |
| **HDD (吞吐优化)** | **st1** | 吞吐量优化（Throughput Optimized）。 | 大数据处理（MapReduce, Kafka, Log processing）、数据仓库。 | 关注**高吞吐量**（MB/s）而非 IOPS。**不能作为启动卷（Boot Volume）**。 |
| **HDD (冷存储)** | **sc1** | 成本最低的 HDD。 | 不常访问的数据归档、旧日志存储。 | 关注**最低成本**。**不能作为启动卷**。 |

> [!NOTE]
> **启动卷限制**：只有 SSD (gp2, gp3, io1, io2) 可以作为 EC2 的启动卷（C盘/Root Volume）。st1 和 sc1 只能作为数据卷。

---

## 2. 关键功能与配置

### IOPS 与 吞吐量 (Throughput)
*   **IOPS (Input/Output Operations Per Second)**：衡量**随机读写**性能。数据库（SQL/NoSQL）通常关注 IOPS。SSD 卷（gp, io）以 IOPS 为核心指标。
*   **吞吐量 (Throughput, MB/s)**：衡量**顺序读写**性能。大数据分析、日志处理通常关注吞吐量。HDD 卷（st1, sc1）以吞吐量为核心指标。
*   **配置陷阱**：对于 gp2，IOPS 是基于容量的（3 IOPS/GB），最大 16,000。如果你需要更高 IOPS 但不需要更多存储，gp2 会导致成本浪费，此时应选 **gp3**（独立配置 IOPS）或 **io1/io2**。

### EBS 优化实例 (EBS-Optimized Instances)
*   提供**专用带宽**用于 EC2 与 EBS 之间的数据传输，不与网络流量争抢带宽。
*   绝大多数现代 EC2 实例（如 m5, c5, r5 等）默认开启且免费。
*   **考点**：如果题目提到“EBS 性能受网络流量影响”或“I/O 不稳定”，解决方案通常是启用/选择 EBS 优化实例。

### 弹性卷 (Elastic Volumes)
*   **在线修改**：可以在**不停止实例**、**不卸载卷**的情况下，修改 EBS 卷的：
    1.  **大小**（只能扩容，不能缩容！）
    2.  **类型**（例如 gp2 -> gp3，或者 io1 -> gp3）
    3.  **IOPS / 吞吐量**（针对 gp3, io1 等）
*   **操作流程**：在控制台修改 -> 等待优化完成 -> **在操作系统内部扩展文件系统**（这一步常被忽略，是常见考点）。

### 多重挂载 (Multi-Attach)
*   **限制**：仅支持 **io1** 和 **io2** 系列。
*   **功能**：允许将**同一个** EBS 卷同时挂载到同一 AZ 内的**多个**（最多16个）EC2 实例。
*   **场景**：集群应用（如 Linux 集群），需要共享存储。
*   **重要提示**：标准的各类文件系统（ext4, xfs, ntfs）**不支持**多重挂载（会损坏数据）。必须使用**集群文件系统**（如 GFS2, cLVM）。如果题目只需要简单的共享文件存储供多台 Web 服务器使用，通常**EFS** 是更优选，而非 EBS Multi-Attach。

---

## 3. 数据保护与操作 (Data Protection & Operations)

### 快照 (Snapshots)
*   **增量备份**：第一个快照是全量的，后续快照仅保存变更的数据块。这不仅节省空间，也加快了快照速度。
*   **S3 存储**：快照实际存储在 S3 中（由 AWS 管理，用户不可直接访问 S3 Bucket）。
*   **区域性**：快照属于特定区域（Region）。要跨区域使用，必须执行**复制快照 (Copy Snapshot)** 操作。
*   **可用性**：可以通过快照在不同 AZ 甚至不同 Region 创建新卷（EBS 卷本身是 AZ 锁定的，但快照是跨 AZ 可用的）。

### 快照生命周期管理 (DLM - Data Lifecycle Manager)
*   **自动化**：通过策略自动创建、保留和删除 EBS 快照。
*   **场景**：满足合规性要求（例如：每天备份，保留30天）。无需编写 Lambda 脚本即可实现备份自动化。

### 加密 (Encryption)
*   **默认加密**：可以设置账户级别的“默认加密”，使得该 Region 内新创建的所有 EBS 卷自动加密。
*   **KMS 集成**：使用 AWS KMS 密钥（CMK）进行加密。
*   **加密传递**：
    *   加密卷的快照 -> 自动加密。
    *   加密快照恢复的卷 -> 自动加密。
*   **如何加密现有未加密卷？**（经典考题）
    1.  对未加密卷做快照。
    2.  **复制**该快照，并在复制过程中选择“加密”。
    3.  使用新的加密快照创建一个新的 EBS 卷。
    4.  挂载新卷，替换旧卷。

---

## 4. 高级架构与场景

### RAID 配置 (RAID 0 vs RAID 1)
EBS 卷本身在后台已经在同一 AZ 内进行了复制（即本身就有一定的冗余），但在某些场景下还需要配置 RAID。

| 类型 | 描述 | 目的 | 风险/代价 | SAA 场景 |
| :--- | :--- | :--- | :--- | :--- |
| **RAID 0 (Striping)** | 将数据分条写入多个卷。I/O 性能叠加。 | **极大提升 I/O 性能**。 | **无冗余**。任何一个卷损坏，所有数据丢失。 | 需要极高吞吐量/IOPS，且应用层有其他数据恢复机制（如分片数据库的从节点）。 |
| **RAID 1 (Mirroring)** | 将数据镜像写入两个卷。 | **提升冗余与容错**。 | 写入性能略受影响，成本翻倍（存储两份）。 | 关键任务应用，不能容忍 EBS 自身的故障风险（虽然极低）。 |

### Instance Store (实例存储) vs EBS
这是 SAA 考试中极易混淆的概念，也是“高性能”题目的常见干扰项。

*   **Instance Store (Ephemeral)**：
    *   物理连接在宿主机上的磁盘（NVMe SSD）。
    *   **极高 I/O 性能**（优于 EBS）。
    *   **临时性**：如果 EC2 停止 (Stop) 或 终止 (Terminate)，**数据会丢失**。（重启 Reboot 数据保留）。
    *   **场景**：缓存、缓冲区、临时数据处理、Replicated 数据库的临时层。
*   **EBS**：
    *   网络存储。
    *   **持久性**：EC2 停止后数据仍然存在。
    *   **场景**：数据持久化、数据库存储、文件系统。

> [!CAUTION]
> **Trap Alert**: 题目如果问“需要最高性能的磁盘 I/O 且数据只需临时存储”或“应用自带复制机制，单节点数据丢失可接受”，答案通常是 **Instance Store**，而不是 io2 EBS。

---

## 5. 总结：考试决策树

1.  **需要共享文件存储？**
    *   Linux 实例 -> **EFS**
    *   Windows 实例 -> **FSx for Windows**
    *   高性能并行计算 (HPC) -> **FSx for Lustre**
    *   必须用块存储 (Block Storage) 且有集群文件系统 -> **EBS Multi-Attach (io1/io2)**

2.  **需要调整性能或容量？**
    *   使用 **Elastic Volumes** 在线调整（无需停机）。

3.  **需要跨区域容灾？**
    *   **Snapshot** -> **Copy Snapshot** (to target Region) -> **Create Volume** (in target Region)。

4.  **成本优化？**
    *   通用场景 -> **gp3**
    *   大数据/日志 -> **st1**
    *   归档/冷数据 -> **sc1** (注意不能引导)
    *   非关键/临时强缓冲 -> **Instance Store**
